{"version":3,"sources":["../src/gateways_modal.js"],"names":["showModalWithPlaceholder","ModalFactory","Templates","render","body","create","modal","show","process","component","paymentArea","itemId","Promise","all","Repository","getConfigForJs","then","payunityConfig","loadSdk","purchaseid","environment","form","document","createElement","resourcePath","url","rooturl","setAttribute","classList","add","setBody","x","resolve","setTimeout","base","sdkUrl","currentlyloaded","suspectedScript","querySelector","parentNode","removeChild","script","readyState","onreadystatechange","onload","head","appendChild"],"mappings":"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","sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable no-unused-vars */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is responsible for PayPal content in the gateways modal.\n *\n * @module     paygw_payunity/gateway_modal\n * @copyright  2022 Wunderbyte Gmbh <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Repository from './repository';\nimport Templates from 'core/templates';\nimport Truncate from 'core/truncate';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Creates and shows a modal that contains a placeholder.\n *\n * @returns {Promise<Modal>}\n */\nconst showModalWithPlaceholder = async() => {\n    const modal = await ModalFactory.create({\n        body: await Templates.render('paygw_payunity/paypal_button_placeholder', {})\n    });\n    modal.show();\n    return modal;\n};\n\n/**\n * Process the payment.\n *\n * @param {string} component Name of the component that the itemId belongs to\n * @param {string} paymentArea The area of the component that the itemId belongs to\n * @param {number} itemId An internal identifier that is used by the component\n * @param {string} description Description of the payment\n * @returns {Promise<string>}\n */\nexport const process = (component, paymentArea, itemId, description) => {\n    return Promise.all([\n        showModalWithPlaceholder(),\n        Repository.getConfigForJs(component, paymentArea, itemId),\n    ])\n    .then(([modal, payunityConfig]) => {\n        return Promise.all([\n            modal,\n            payunityConfig,\n            loadSdk(payunityConfig.purchaseid, payunityConfig.environment),\n        ]);\n    })\n    .then(([modal, payunityConfig]) => {\n\n       const form = document.createElement('form');\n       const resourcePath = `/v1/checkouts/${payunityConfig.purchaseid}/payment`;\n       const url = `${payunityConfig.rooturl}/payment/gateway/payunity/checkout.php?resourcepath=${resourcePath}&itemid=${itemId}&orderid=${payunityConfig.purchaseid}&component=${component}&paymentarea=${paymentArea}`;\n       form.setAttribute('action', url);\n       form.classList.add('paymentWidgets');\n       form.setAttribute('data-brands', \"VISA MASTER AMEX\");\n        modal.setBody(form);\n        return '';\n    }).then(x => new Promise(resolve => setTimeout(() => resolve(x), 100000))\n    );\n};\n\n/**\n * Returns Form\n * @param {string} purchaseid Purchase Id\n * @param {string} environment Environment\n * @returns {Promise}\n */\nconst loadSdk = (purchaseid, environment) => {\n    let base = '';\n    if (environment === 'sandbox') {\n    base = 'https://eu-test.oppwa.com/';\n    } else {\n    base = 'https://eu-prod.oppwa.com/';\n    }\n    const sdkUrl = `${base}v1/paymentWidgets.js?checkoutId=${purchaseid}`;\n\n    // Check to see if this file has already been loaded. If so just go straight to the func.\n    if (loadSdk.currentlyloaded === sdkUrl) {\n        return Promise.resolve();\n    }\n\n    if (loadSdk.currentlyloaded) {\n        const suspectedScript = document.querySelector(`script[src=\"${loadSdk.currentlyloaded}\"]`);\n        if (suspectedScript) {\n            suspectedScript.parentNode.removeChild(suspectedScript);\n        }\n    }\n\n    const script = document.createElement('script');\n\n    return new Promise(resolve => {\n        if (script.readyState) {\n            script.onreadystatechange = function() {\n                if (this.readyState == 'complete' || this.readyState == 'loaded') {\n                    this.onreadystatechange = null;\n                    resolve();\n                }\n            };\n        } else {\n            script.onload = function() {\n                resolve();\n            };\n        }\n\n        script.setAttribute('src', sdkUrl);\n        document.head.appendChild(script);\n\n        loadSdk.currentlyloaded = sdkUrl;\n    });\n};\n\n/**\n * Holds the full url\n *\n * @static\n * @type {string}\n */\n loadSdk.currentlyloaded = '';\n"],"file":"gateways_modal.min.js"}