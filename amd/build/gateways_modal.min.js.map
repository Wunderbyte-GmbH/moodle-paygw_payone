{"version":3,"file":"gateways_modal.min.js","sources":["../src/gateways_modal.js"],"sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable no-unused-vars */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is responsible for PayUnity content in the gateways modal.\n *\n * @module     paygw_payunity/gateway_modal\n * @copyright  2022 Wunderbyte Gmbh <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Repository from './repository';\nimport Templates from 'core/templates';\nimport Truncate from 'core/truncate';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Creates and shows a modal that contains a placeholder.\n *\n * @returns {Promise<Modal>}\n */\nconst showModalWithPlaceholder = async() => {\n    const modal = await ModalFactory.create({\n        body: await Templates.render('paygw_payunity/payunity_button_placeholder', {})\n    });\n    modal.show();\n    return modal;\n};\n\n/**\n * Process the payment.\n *\n * @param {string} component Name of the component that the itemId belongs to\n * @param {string} paymentArea The area of the component that the itemId belongs to\n * @param {number} itemId An internal identifier that is used by the component\n * @param {string} description Description of the payment\n * @returns {Promise<string>}\n */\nexport const process = (component, paymentArea, itemId, description) => {\n    return Promise.all([\n        showModalWithPlaceholder(),\n        Repository.getConfigForJs(component, paymentArea, itemId),\n    ])\n    .then(([modal, payunityConfig]) => {\n\n        if (payunityConfig.purchaseid !== null) {\n            window.location = payunityConfig.rooturl;\n        }\n        return '';\n        })\n    .then(x => {\n        const promise = new Promise(resolve => {\n            window.addEventListener('onbeforeunload', (e) => {\n                promise.resolve();\n            });\n        });\n        return promise;\n    });\n};\n\n"],"names":["_interopRequireDefault","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","Repository","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_interopRequireWildcard","_templates","_truncate","_modal_factory","_modal_events","showModalWithPlaceholder","async","modal","ModalFactory","create","body","Templates","render","show","_exports","process","component","paymentArea","itemId","description","Promise","all","getConfigForJs","then","_ref","payunityConfig","purchaseid","window","location","rooturl","x","promise","resolve","addEventListener"],"mappings":"6OA6B4C,SAAAA,uBAAAC,KAAAA,OAAAA,KAAAA,IAAAC,WAAAD,IAAAE,CAAAA,QAAAF,IAAA,CAAA,SAAAG,yBAAAC,GAAA,GAAA,mBAAAC,QAAA,OAAA,KAAA,IAAAC,EAAAD,IAAAA,QAAAE,EAAAF,IAAAA,eAAAF,yBAAA,SAAAC,GAAAA,OAAAA,EAAAG,EAAAD,IAAAF,EAAA,iFAJ5CI,WAI4C,SAAAJ,EAAAE,GAAAA,IAAAA,GAAAF,GAAAA,EAAAH,WAAAG,OAAAA,EAAAA,GAAAA,OAAAA,GAAAA,iBAAAA,GAAAA,mBAAAA,EAAAF,MAAAA,CAAAA,QAAAE,GAAAG,IAAAA,EAAAJ,yBAAAG,GAAA,GAAAC,GAAAA,EAAAE,IAAAL,GAAA,OAAAG,EAAAG,IAAAN,GAAA,IAAAO,EAAA,CAAAC,UAAA,MAAAC,EAAAC,OAAAC,gBAAAD,OAAAE,yBAAA,IAAA,IAAAC,KAAAb,EAAAa,GAAAA,YAAAA,GAAAC,CAAAA,EAAAA,eAAAC,KAAAf,EAAAa,GAAAG,CAAAA,IAAAA,EAAAP,EAAAC,OAAAE,yBAAAZ,EAAAa,GAAAG,KAAAA,IAAAA,EAAAV,KAAAU,EAAAC,KAAAP,OAAAC,eAAAJ,EAAAM,EAAAG,GAAAT,EAAAM,GAAAb,EAAAa,GAAAN,OAAAA,EAAAT,QAAAE,EAAAG,GAAAA,EAAAc,IAAAjB,EAAAO,GAAAA;;;;;;;KAAA,CAJ5CW,CAAAd,YACAe,WAAAxB,uBAAAwB,YACAC,UAAAzB,uBAAAyB,WACAC,eAAA1B,uBAAA0B,gBACAC,cAAA3B,uBAAA2B,eAQA,MAAMC,yBAA2BC,UAC7B,MAAMC,YAAcC,eAAY5B,QAAC6B,OAAO,CACpCC,WAAYC,WAAS/B,QAACgC,OAAO,6CAA8C,CAAA,KAG/E,OADAL,MAAMM,OACCN,KAAK,EAgCdO,SAAAC,QApBqBA,CAACC,UAAWC,YAAaC,OAAQC,cAC7CC,QAAQC,IAAI,CACfhB,2BACAnB,WAAWoC,eAAeN,UAAWC,YAAaC,UAErDK,MAAKC,OAA6B,IAA3BjB,MAAOkB,gBAAeD,KAK1B,OAHkC,OAA9BC,eAAeC,aACfC,OAAOC,SAAWH,eAAeI,SAE9B,EAAE,IAEZN,MAAKO,IACF,MAAMC,QAAU,IAAIX,SAAQY,UACxBL,OAAOM,iBAAiB,kBAAmBnD,IACvCiD,QAAQC,SAAS,GACnB,IAEN,OAAOD,OAAO,GAEpB"}