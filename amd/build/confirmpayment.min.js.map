{"version":3,"sources":["../src/confirmpayment.js"],"names":["init","orderid","itemid","paymentarea","component","resourcePath","Ajax","call","methodname","args","done","data","success","require","$","str","localStrings","get_strings","key","when","localizedEditStrings","ModalFactory","create","type","types","CANCEL","title","body","message","buttons","cancel","then","modal","root","getRoot","on","ModalEvents","location","href","url","show","catch","fail"],"mappings":"uMAuBA,OACA,OACA,O,mDAWO,GAAMA,CAAAA,CAAI,CAAG,SAACC,CAAD,CACAC,CADA,CAEAC,CAFA,CAGAC,CAHA,CAIAC,CAJA,CAMe,CAG/BC,UAAKC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,4CADL,CAEPC,IAAI,CAAE,CACFL,SAAS,CAATA,CADE,CAEFD,WAAW,CAAXA,CAFE,CAGFF,OAAO,CAAPA,CAHE,CAIFC,MAAM,CAANA,CAJE,CAKFG,YAAY,CAAZA,CALE,CAFC,CASPK,IAAI,CAAE,cAASC,CAAT,CAAe,CAGjB,GAAI,KAAAA,CAAI,CAACC,OAAT,CAA2B,CAE3BC,OAAO,CAAC,CAAC,QAAD,CAAD,CAAa,SAASC,CAAT,CAAY,CAC5BD,OAAO,CAAC,CAAC,UAAD,CAAD,CAAe,SAASE,CAAT,CAAc,IAa5BC,CAAAA,CAAY,CAAGD,CAAG,CAACE,WAAJ,CAXL,CACV,CACIC,GAAG,CAAE,OADT,CAEId,SAAS,CAAE,gBAFf,CADU,CAKV,CACIc,GAAG,CAAE,SADT,CAEId,SAAS,CAAE,gBAFf,CALU,CAWK,CAba,CAchCU,CAAC,CAACK,IAAF,CAAOH,CAAP,EAAqBN,IAArB,CAA0B,SAASU,CAAT,CAA+B,CAErDC,UAAaC,MAAb,CAAoB,CAChBC,IAAI,CAAEF,UAAaG,KAAb,CAAmBC,MADT,CAEhBC,KAAK,CAAEN,CAAoB,CAAC,CAAD,CAFX,CAGhBO,IAAI,CAAEhB,CAAI,CAACiB,OAHK,CAIhBC,OAAO,CAAE,CACLC,MAAM,CAAEV,CAAoB,CAAC,CAAD,CADvB,CAJO,CAApB,EAQCW,IARD,CAQM,SAASC,CAAT,CAAgB,CAClB,GAAIC,CAAAA,CAAI,CAAGD,CAAK,CAACE,OAAN,EAAX,CACAD,CAAI,CAACE,EAAL,CAAQC,UAAYN,MAApB,CAA4B,UAAW,CACnCO,QAAQ,CAACC,IAAT,CAAgB3B,CAAI,CAAC4B,GACxB,CAFD,EAGAP,CAAK,CAACQ,IAAN,GACA,QACH,CAfD,EAeGC,KAfH,CAeS,EAfT,CAoBH,CAtBD,CAuBH,CArCM,CAsCV,CAvCM,CAwCV,CA1CG,IA0CG,CACHJ,QAAQ,CAACC,IAAT,CAAgB3B,CAAI,CAAC4B,GACxB,CAEA,CA1DM,CA2DPG,IAAI,CAAE,eAAW,CAGhB,CA9DM,CAAD,CAAV,CAiEH,CA1EM,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * PayUnity repository module to encapsulate all of the AJAX requests that can be sent for PayUnity.\n *\n * @module     paygw_payunity/confirmpayment\n * @copyright  2022 Georg Mai√üer <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\n/**\n * Confirm checkout.\n * @param {string} orderid\n * @param {string} itemid\n * @param {string} paymentarea\n * @param {string} component\n * @param {string} resourcePath\n * @param {string} successurl\n */\nexport const init = (orderid,\n                    itemid,\n                    paymentarea,\n                    component,\n                    resourcePath,\n                    // eslint-disable-next-line no-unused-vars\n                    successurl) => {\n\n\n    Ajax.call([{\n        methodname: \"paygw_payunity_create_transaction_complete\",\n        args: {\n            component,\n            paymentarea,\n            orderid,\n            itemid,\n            resourcePath,\n        },\n        done: function(data) {\n\n\n            if (data.success !== true) {\n\n            require(['jquery'], function($) {\n                require(['core/str'], function(str) {\n\n                    var strings = [\n                        {\n                            key: 'error',\n                            component: 'paygw_payunity'\n                        },\n                        {\n                            key: 'proceed',\n                            component: 'paygw_payunity',\n                        }\n                    ];\n\n                    var localStrings = str.get_strings(strings);\n                    $.when(localStrings).done(function(localizedEditStrings) {\n\n                        ModalFactory.create({\n                            type: ModalFactory.types.CANCEL,\n                            title: localizedEditStrings[0] ,\n                            body: data.message,\n                            buttons: {\n                                cancel: localizedEditStrings[1],\n                            },\n                        })\n                        .then(function(modal) {\n                            var root = modal.getRoot();\n                            root.on(ModalEvents.cancel, function() {\n                                location.href = data.url;\n                            });\n                            modal.show();\n                            return true;\n                        }).catch({\n                            // eslint-disable-next-line no-console\n                            // console.log(e);\n                        });\n\n                    });\n                });\n            });\n        } else {\n            location.href = data.url;\n        }\n\n        },\n        fail: function() {\n            // eslint-disable-next-line no-console\n            // console.log(\"ex:\" + ex);\n        },\n    }]);\n\n};"],"file":"confirmpayment.min.js"}